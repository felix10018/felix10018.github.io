(window.webpackJsonp=window.webpackJsonp||[]).push([[131],{623:function(s,t,a){"use strict";a.r(t);var n=a(30),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"如何搞定渲染器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何搞定渲染器"}},[s._v("#")]),s._v(" 如何搞定渲染器")]),s._v(" "),a("p",[s._v("在 Django 中，渲染器（Renderers）用于将数据以特定的格式返回给客户端。")]),s._v(" "),a("p",[s._v("Django 之渲染器（Renderers）在 Django REST framework（DRF）中扮演着重要的角色，它们负责将响应数据序列化为特定的媒体类型（如 JSON、XML、YAML 等），并返回给客户端。DRF 提供了多种内置的渲染器类，并允许用户编写自定义渲染器来满足特定需求。以下是对 Django 渲染器的详细解析：")]),s._v(" "),a("h3",{attrs:{id:"渲染器的基本原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#渲染器的基本原理"}},[s._v("#")]),s._v(" 渲染器的基本原理")]),s._v(" "),a("p",[s._v("渲染器的主要作用是将序列化后的数据转换为最终的响应体内容，这包括将数据编码成特定的格式（如 JSON、XML）以及设置响应的 Content-Type 头部。在 DRF 中，渲染器是通过 renderer_classes 属性在视图或视图集中指定的，它可以是单个渲染器类，也可以是一个包含多个渲染器类的列表。")]),s._v(" "),a("h3",{attrs:{id:"内置的渲染器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内置的渲染器"}},[s._v("#")]),s._v(" 内置的渲染器")]),s._v(" "),a("p",[s._v("DRF 提供了多种内置的渲染器类，包括：")]),s._v(" "),a("p",[s._v("JSONRenderer：将响应数据渲染成 JSON 格式。这是最常用的渲染器之一，因为 JSON 是 Web 开发中广泛使用的数据交换格式。\nBrowsableAPIRenderer：这是一个特殊的渲染器，它返回一个可浏览的 API 页面，允许用户通过 Web 浏览器直接查看和测试 API。这对于开发和调试 API 非常有用。\nTemplateHTMLRenderer：使用 Django 的模板系统将数据渲染成 HTML 格式。这适用于需要返回 HTML 内容的 API 视图。\nStaticHTMLRenderer：与 TemplateHTMLRenderer 不同，StaticHTMLRenderer 直接返回预渲染的 HTML 字符串，而不是通过模板系统。\nYAMLRenderer：将响应数据渲染成 YAML 格式。YAML 是一种易于人类阅读的数据序列化标准，但在 Web API 中不如 JSON 常用。")]),s._v(" "),a("h3",{attrs:{id:"一个简单例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一个简单例子"}},[s._v("#")]),s._v(" 一个简单例子")]),s._v(" "),a("p",[s._v("例如，在视图函数中，可以通过设置 "),a("code",[s._v("renderer_classes")]),s._v(" 属性来指定使用的渲染器：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("renderers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" JSONRenderer\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("views "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" APIView\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("APIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    renderer_classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("JSONRenderer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        data "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hello, World!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("这样，当客户端请求该视图时，将得到以 JSON 格式渲染的数据。")]),s._v(" "),a("h3",{attrs:{id:"结合drf的使用自定义渲染器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结合drf的使用自定义渲染器"}},[s._v("#")]),s._v(" 结合drf的使用自定义渲染器")]),s._v(" "),a("p",[s._v("如果内置的渲染器无法满足你的需求，你可以通过继承 BaseRenderer 类或现有的渲染器类来创建自定义渲染器。在自定义渲染器中，你需要重写 render 方法来定义如何将数据渲染成特定的格式。")]),s._v(" "),a("p",[s._v("例如，以下是一个简单的自定义 JSON 渲染器示例，它在返回 JSON 数据时添加了额外的响应字段：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("renderers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" JSONRenderer  \n  \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyJSONRenderer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("JSONRenderer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" accepted_media_type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" renderer_context"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在这里添加额外的响应字段  ")]),s._v("\n        response_data "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'status'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'success'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'data'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调用父类的 render 方法来渲染数据  ")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("render"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("response_data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" accepted_media_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" renderer_context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"渲染器的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#渲染器的配置"}},[s._v("#")]),s._v(" 渲染器的配置")]),s._v(" "),a("p",[s._v("可以在 Django 的 settings.py 文件中通过 REST_FRAMEWORK 配置项来全局指定默认的渲染器集。例如：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("REST_FRAMEWORK "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'DEFAULT_RENDERER_CLASSES'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("  \n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rest_framework.renderers.JSONRenderer'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  \n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rest_framework.renderers.BrowsableAPIRenderer'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("此外也可以在视图或视图集中通过 renderer_classes 属性来指定单个视图或视图集使用的渲染器。")])])}),[],!1,null,null,null);t.default=e.exports}}]);